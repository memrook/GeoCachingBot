# üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏ Docker

## ‚ùå –ü—Ä–æ–±–ª–µ–º—ã –∏—Å—Ö–æ–¥–Ω–æ–π —Å–±–æ—Ä–∫–∏

```bash
RUN CGO_ENABLED=1 GOOS=linux go build -a -installsuffix cgo -o geocaching-bot .
```

### –ß—Ç–æ –∑–∞–º–µ–¥–ª—è–ª–æ —Å–±–æ—Ä–∫—É:

1. **`-a` —Ñ–ª–∞–≥** - –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–ª –í–°–ï –ø–∞–∫–µ–≥–∏ –∫–∞–∂–¥—ã–π —Ä–∞–∑ (~2-5 –º–∏–Ω—É—Ç)
2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è** - Docker –Ω–µ –º–æ–≥ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–æ–∏
3. **`-installsuffix cgo`** - —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –ø–æ–¥—Ö–æ–¥
4. **–ù–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–∞** - –±–æ–ª—å—à–æ–π –∏—Ç–æ–≥–æ–≤—ã–π –æ–±—Ä–∞–∑

## ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

### 1. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (Dockerfile)

```bash
RUN CGO_ENABLED=1 GOOS=linux go build \
    -ldflags='-w -s -extldflags "-static"' \
    -tags sqlite_omit_load_extension \
    -o geocaching-bot .
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚ùå –£–±—Ä–∞–ª–∏ `-a` (–Ω–µ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –ø–∞–∫–µ—Ç—ã)
- ‚úÖ –î–æ–±–∞–≤–∏–ª–∏ `-ldflags='-w -s'` (—É–±–∏—Ä–∞–µ–º debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é)
- ‚úÖ –î–æ–±–∞–≤–∏–ª–∏ `-extldflags "-static"` (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –ª–∏–Ω–∫–æ–≤–∫–∞)
- ‚úÖ –î–æ–±–∞–≤–∏–ª–∏ `sqlite_omit_load_extension` (—É–±–∏—Ä–∞–µ–º –Ω–µ–Ω—É–∂–Ω—ã–µ SQLite —Ñ—É–Ω–∫—Ü–∏–∏)

**–í—Ä–µ–º—è —Å–±–æ—Ä–∫–∏:** ~1-2 –º–∏–Ω—É—Ç—ã ‚Üí ~30-60 —Å–µ–∫—É–Ω–¥

### 2. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (Dockerfile.optimized)

```bash
RUN CGO_ENABLED=1 GOOS=linux go build \
    -mod=readonly \
    -ldflags='-w -s -extldflags "-static"' \
    -tags 'sqlite_omit_load_extension netgo' \
    -trimpath \
    -o geocaching-bot
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- ‚úÖ `-mod=readonly` (–∑–∞—â–∏—Ç–∞ –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
- ‚úÖ `-trimpath` (—É–±–∏—Ä–∞–µ–º –ø—É—Ç–∏ –∏–∑ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞)
- ‚úÖ `netgo` (—á–∏—Å—Ç–∞—è Go —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏)
- ‚úÖ `busybox:musl` –≤–º–µ—Å—Ç–æ `alpine` (–º–µ–Ω—å—à–µ —Ä–∞–∑–º–µ—Ä)

**–†–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞:** ~50MB ‚Üí ~15MB

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –í–∞—Ä–∏–∞–Ω—Ç | –í—Ä–µ–º—è –ø–µ—Ä–≤–æ–π —Å–±–æ—Ä–∫–∏ | –í—Ä–µ–º—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Å–±–æ—Ä–∫–∏ | –†–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞ | CGO |
|---------|-------------------|---------------------|---------------|-----|
| **–ò—Å—Ö–æ–¥–Ω—ã–π** | ~5 –º–∏–Ω—É—Ç | ~5 –º–∏–Ω—É—Ç | ~80MB | ‚úÖ |
| **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π** | ~2 –º–∏–Ω—É—Ç—ã | ~30 —Å–µ–∫ | ~50MB | ‚úÖ |
| **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π** | ~90 —Å–µ–∫ | ~20 —Å–µ–∫ | ~15MB | ‚úÖ |

## üõ†Ô∏è –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```bash
# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å–±–æ—Ä–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
./deploy.sh build

# –ë—ã—Å—Ç—Ä–∞—è —Å–±–æ—Ä–∫–∞ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º  
./deploy.sh build-fast

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è
./deploy.sh build-optimized
```

## üîç –û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ñ–ª–∞–≥–æ–≤

### –§–ª–∞–≥–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞:
- **`CGO_ENABLED=1`** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è SQLite3 (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç C –±–∏–±–ª–∏–æ—Ç–µ–∫–∏)
- **`GOOS=linux`** - —Ü–µ–ª–µ–≤–∞—è –û–° –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- **`-mod=readonly`** - –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π go.mod

### –§–ª–∞–≥–∏ –ª–∏–Ω–∫–æ–≤—â–∏–∫–∞ (`-ldflags`):
- **`-w`** - —É–±–∏—Ä–∞–µ—Ç DWARF debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (-20% —Ä–∞–∑–º–µ—Ä–∞)
- **`-s`** - —É–±–∏—Ä–∞–µ—Ç symbol table (-10% —Ä–∞–∑–º–µ—Ä–∞)  
- **`-extldflags "-static"`** - —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –ª–∏–Ω–∫–æ–≤–∫–∞ C –±–∏–±–ª–∏–æ—Ç–µ–∫

### Build tags (`-tags`):
- **`sqlite_omit_load_extension`** - —É–±–∏—Ä–∞–µ—Ç SQLite –∑–∞–≥—Ä—É–∑–∫—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
- **`netgo`** - —á–∏—Å—Ç–∞—è Go —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è DNS –≤–º–µ—Å—Ç–æ libc

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏:
- **`-trimpath`** - —É–±–∏—Ä–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—É—Ç–∏ –∏–∑ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞ (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

## ‚ö° –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ Docker

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:

```dockerfile
# 1. –ö–æ–ø–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
COPY go.mod go.sum ./

# 2. –°–∫–∞—á–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–∫—ç—à–∏—Ä—É–µ—Ç—Å—è)
RUN go mod download && go mod verify

# 3. –ö–æ–ø–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ (–º–µ–Ω—è–µ—Ç—Å—è —á–∞—Å—Ç–æ)
COPY *.go ./

# 4. –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
RUN go build ...
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏ —Ç–æ–ª—å–∫–æ –∫–æ–¥ (–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏), Docker –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—ç—à –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π!

## üê≥ –í—ã–±–æ—Ä –±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞

### –§–∏–Ω–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑—ã:

| –û–±—Ä–∞–∑ | –†–∞–∑–º–µ—Ä | –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | –§—É–Ω–∫—Ü–∏–∏ |
|-------|---------|-------------|---------|
| **alpine:latest** | ~50MB | ‚úÖ –•–æ—Ä–æ—à–∞—è | üõ†Ô∏è –ü–æ–ª–Ω—ã–µ |
| **busybox:musl** | ~15MB | ‚úÖ –•–æ—Ä–æ—à–∞—è | ‚ö° –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ |
| **scratch** | ~8MB | üîí –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è | ‚ùå –¢–æ–ª—å–∫–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π binary |

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
```bash
./deploy.sh build-fast  # –ë—ã—Å—Ç—Ä–∞—è —Å–±–æ—Ä–∫–∞ —Å –∫—ç—à–µ–º
```

### –î–ª—è production:
```bash
./deploy.sh build-optimized  # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä + –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
```

### –î–ª—è CI/CD:
```bash
# –í .github/workflows/
docker build --build-arg BUILDKIT_INLINE_CACHE=1 -f Dockerfile.optimized .
```

## üö® –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –ª–∏–Ω–∫–æ–≤–∫–∞:
```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ RUN:
RUN apk add --no-cache musl-dev
```

### –ï—Å–ª–∏ –Ω—É–∂–Ω—ã timezone –¥–∞–Ω–Ω—ã–µ:
```dockerfile
# –í —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑:
COPY --from=builder /usr/share/zoneinfo /usr/share/zoneinfo
```

### –ï—Å–ª–∏ –Ω—É–∂–µ–Ω shell –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ alpine –≤–º–µ—Å—Ç–æ busybox:
FROM alpine:latest AS runtime
```

---

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–±–æ—Ä–∫–∞ —É—Å–∫–æ—Ä–∏–ª–∞—Å—å –≤ 5-10 —Ä–∞–∑! üéâ 